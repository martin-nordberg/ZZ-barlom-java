<!DOCTYPE html>
<html>

<head lang="en">

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <title>Barlom-GDB Console</title>

    <!-- Blaze CSS -->
    <link rel="stylesheet" href="https://unpkg.com/blaze">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.1.js"
            integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
            crossorigin="anonymous"></script>

    <!-- Riot.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/riot/2.6.4/riot+compiler.min.js"></script>

    <!-- Riot tags -->
    <script src="tags/content/vertextype.html" type="riot/tag"></script>
    <script src="tags/content/vertextypes.html" type="riot/tag"></script>
    <script src="tags/navigation/leftnavigation.html" type="riot/tag"></script>

</head>

<body id="console-id" class="c-text">

    <main class="o-grid o-grid--no-gutter o-panel">
        <div data-is="barlom-gdb-leftnavigation"></div>
        <div class="o-grid__cell--width-85 o-panel-container">
            <nav class="c-nav c-nav--inline c-nav--light">
                <span class="c-nav__item">TBD</span>
                <span class="c-nav__item">TBD</span>
                <span class="c-nav__item c-nav__item--right"><a href="/barlomgdbconsole/exit">Exit</a></span>
                <span class="c-nav__item c-nav__item--right">TBD</span>
            </nav>
            <div id="content" class="o-panel o-panel--nav-top">
                <!-- Filled dynamically according to hash tag. -->
            </div>
        </div>
    </main>

</body>

<script>

  function loadVertexType( uuid ) {

    $.getJSON( '/barlomgdbconsolecontent/vertextypes/' + uuid )
      .done(
        function ( vertextype ) {
          const content = `<barlom-gdb-vertextype uuid="${vertextype.uuid}" name="${vertextype.name}"></barlom-gdb-vertextype>`;
          $( '#content' ).html( content );
          riot.mount( '*' );
        }
      )
      .fail(
        function ( jqxhr, textStatus, error ) {
          const err = textStatus + ", " + error;
          alert( "Request Failed: " + err );
        }
      );

  }

  function loadVertexTypes() {

    $.getJSON( '/barlomgdbconsolecontent/vertextypes' )
      .done(
        function ( response ) {
          let content = "<barlom-gdb-vertextypes>";
          for ( let vertextype of response.data ) {
            content += `<barlom-gdb-vertextype uuid="${vertextype.uuid}" name="${vertextype.name}" linked="true"></barlom-gdb-vertextype>`;
          }
          content += "</barlom-gdb-vertextypes>";
          $( '#content' ).html( content );
          riot.mount( '*' );
        }
      )
      .fail(
        function ( jqxhr, textStatus, error ) {
          const err = textStatus + ", " + error;
          alert( "Request Failed: " + err );
        }
      );

  }

  $(
    function () {
      // Vertex types
      riot.route( '/vertextypes/*', loadVertexType );
      riot.route( '/vertextypes', loadVertexTypes );

      // Start routing
      riot.route.start( true );

      riot.mount( '*' );
    }
  );

</script>

</html>