
-------------
-- Package --
-------------

-- Table
CREATE TABLE GRESTLER_PACKAGE (
    ID UUID NOT NULL,
    PARENT_PACKAGE_ID UUID NOT NULL,
    NAME VARCHAR(256) NOT NULL
);

-- Primary key
ALTER TABLE GRESTLER_PACKAGE ADD CONSTRAINT PK_GRESTLER_PACKAGE
    PRIMARY KEY (ID);

-- Foreign keys
ALTER TABLE GRESTLER_PACKAGE ADD CONSTRAINT FK_GRESTLER_PACKAGE__PARENT_PACKAGE
    FOREIGN KEY (PARENT_PACKAGE_ID) REFERENCES GRESTLER_PACKAGE(ID);

-- Constraints
ALTER TABLE GRESTLER_PACKAGE ADD CONSTRAINT UQ_GRESTLER_PACKAGE__NAME
    UNIQUE (PARENT_PACKAGE_ID,NAME);

-- Root package
INSERT INTO GRESTLER_PACKAGE
            ( ID, PARENT_PACKAGE_ID, NAME )
     VALUES ( '00000000-7a26-11e4-a545-08002741a702', '00000000-7a26-11e4-a545-08002741a702', '$' );


-----------------
-- Vertex Type --
-----------------

-- Table
CREATE TABLE GRESTLER_VERTEX_TYPE (
    ID UUID NOT NULL,
    PARENT_PACKAGE_ID UUID NOT NULL,
    NAME VARCHAR(256) NOT NULL,
    SUPER_TYPE_ID UUID NOT NULL
);

-- Primary key
ALTER TABLE GRESTLER_VERTEX_TYPE ADD CONSTRAINT PK_GRESTLER_VERTEX_TYPE
    PRIMARY KEY (ID);

-- Foreign keys
ALTER TABLE GRESTLER_VERTEX_TYPE ADD CONSTRAINT FK_GRESTLER_VERTEX_TYPE__SUPER_TYPE
    FOREIGN KEY (SUPER_TYPE_ID) REFERENCES GRESTLER_VERTEX_TYPE(ID);
ALTER TABLE GRESTLER_VERTEX_TYPE ADD CONSTRAINT FK_GRESTLER_VERTEX_TYPE__PARENT_PACKAGE
    FOREIGN KEY (PARENT_PACKAGE_ID) REFERENCES GRESTLER_PACKAGE(ID);

-- Constraints
ALTER TABLE GRESTLER_VERTEX_TYPE ADD CONSTRAINT UQ_GRESTLER_VERTEX_TYPE__NAME
    UNIQUE (PARENT_PACKAGE_ID,NAME);

-- Generic base vertex type
INSERT INTO GRESTLER_VERTEX_TYPE
            ( ID, PARENT_PACKAGE_ID, NAME, SUPER_TYPE_ID )
     VALUES ( '00000010-7a26-11e4-a545-08002741a702', '00000000-7a26-11e4-a545-08002741a702',
              'Vertex', '00000010-7a26-11e4-a545-08002741a702' );


---------------
-- Edge Type --
---------------

-- Table
CREATE TABLE GRESTLER_EDGE_TYPE (
    ID UUID NOT NULL,
    PARENT_PACKAGE_ID UUID NOT NULL,
    NAME VARCHAR(256) NOT NULL,
    SUPER_TYPE_ID UUID NOT NULL,
    FROM_VERTEX_TYPE_ID UUID NOT NULL,
    TO_VERTEX_TYPE_ID UUID NOT NULL
);

-- Primary key
ALTER TABLE GRESTLER_EDGE_TYPE ADD CONSTRAINT PK_GRESTLER_EDGE_TYPE
    PRIMARY KEY (ID);

-- Foreign keys
ALTER TABLE GRESTLER_EDGE_TYPE ADD CONSTRAINT FK_GRESTLER_EDGE_TYPE__SUPER_TYPE
    FOREIGN KEY (SUPER_TYPE_ID) REFERENCES GRESTLER_EDGE_TYPE(ID);
ALTER TABLE GRESTLER_EDGE_TYPE ADD CONSTRAINT FK_GRESTLER_EDGE_TYPE__PARENT_PACKAGE
    FOREIGN KEY (PARENT_PACKAGE_ID) REFERENCES GRESTLER_PACKAGE(ID);
ALTER TABLE GRESTLER_EDGE_TYPE ADD CONSTRAINT FK_GRESTLER_EDGE_TYPE__FROM_VERTEX_TYPE
    FOREIGN KEY (FROM_VERTEX_TYPE_ID) REFERENCES GRESTLER_VERTEX_TYPE(ID);
ALTER TABLE GRESTLER_EDGE_TYPE ADD CONSTRAINT FK_GRESTLER_EDGE_TYPE__TO_VERTEX_TYPE
    FOREIGN KEY (TO_VERTEX_TYPE_ID) REFERENCES GRESTLER_VERTEX_TYPE(ID);

-- Constraints
ALTER TABLE GRESTLER_EDGE_TYPE ADD CONSTRAINT UQ_GRESTLER_EDGE_TYPE__NAME
    UNIQUE (PARENT_PACKAGE_ID,NAME);

-- Generic base edge type
INSERT INTO GRESTLER_EDGE_TYPE
            ( ID, PARENT_PACKAGE_ID, NAME, SUPER_TYPE_ID, FROM_VERTEX_TYPE_ID, TO_VERTEX_TYPE_ID )
     VALUES ( '00000020-7a26-11e4-a545-08002741a702', '00000000-7a26-11e4-a545-08002741a702',
              'Edge', '00000020-7a26-11e4-a545-08002741a702',
              '00000010-7a26-11e4-a545-08002741a702', '00000010-7a26-11e4-a545-08002741a702' );


